{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.5)), linear-gradient(to right, #757575, #333333);
            color: white;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
    </style>

</head>
<body class="  w-screen ">
 

    <div class="flex w-full items-center justify-center content-center h-screen space-x-10 ">
    <div class="flex  flex-col">
       
        <form method="post" enctype="multipart/form-data"  class="rounded-3xl flex flex-col w-[30rem] text-center space-y-5 border-2 border-gray-200 p-5 " onsubmit="return validateForm()">
            {% csrf_token %}
        {% if msg %} <div class="error bg-red-500 text-white px-4 py-2 rounded" id="errorMsg">{{ msg }}</div> {% endif %}
            <input class="text-black" type="text" name="firstname" id="firstname" placeholder="First name" required>
            <input class="text-black" type="text" name="Lastname" id="lastname" placeholder="Last name" required>
            <input class="text-black" type="text" name="username" id="username" placeholder="Username" required>
            <input class="text-black" type="email" name="email" id="email" placeholder="Email" required>
            <div>
                <label>Date Of Birth</label><br>
                <input class="text-black" type="date" name="dob" id="dob" placeholder="Date Of Birth" required>
            </div>
            <div>
                <label>Date Of Joining</label><br>
                <input class="text-black" type="date" name="doj" id="doj" placeholder="Date Of Join" required>
            </div>
            <input class="text-black" type="text" name="Designation" id="designation" placeholder="Designation" required>
            <select  class="text-black" name="Department" id="department" required>
                <option class="text-black" value="">Select Department</option>
                {% for department in departments %}
                    <option value="{{department.id}}">{{department.department_name}}</option>
                {% endfor %}
            </select>
            <input class="text-black" type="text" name="pnum" id="pnum" placeholder="Phone number" required>
            <!-- Password input field -->
<input class="flex text-center text-black w-[20rem]" type="password" id="pass" name="pass" placeholder="Password" required>

<!-- Button to toggle password visibility -->
<button type="button" id="togglePassVisibility">Show Password</button>

<!-- Confirm password input field -->
<input class="flex text-center text-black w-[20rem]" type="password" id="pass2" name="pass2" placeholder="Confirm password" required>

            <input class="text-white" type="file" name="profile" id="profile" placeholder="Profile" required>
            <input class="bg-green-500 rounded-3xl flex text-center justify-center content-center items-center" type="submit" value="Submit">
            <a href="{% url 'HodDash' %}" class="bg-gray-500 rounded-3xl flex text-center justify-center content-center items-center">Back</a>
        </form>
    </div>
    <div class="w-1/2 ">
        <div id="alertMsg" class="h-[10rem] hidden rounded-3xl w-full mb-10 bg-green-500 text-white text-center flex items-center justify-center">
            User added successfully!
        </div>
        <img class="" src="{% static "img/college.jpeg" %}">
    </div>

    <div>
</body>
<script>
    // Function to toggle password visibility
    function togglePasswordVisibility() {
        var passField = document.getElementById("pass");
        var pass2Field = document.getElementById("pass2");
        var toggleButton = document.getElementById("togglePassVisibility");

        if (passField.type === "password") {
            passField.type = "text";
            pass2Field.type = "text";
            toggleButton.textContent = "Hide Password";
        } else {
            passField.type = "password";
            pass2Field.type = "password";
            toggleButton.textContent = "Show Password";
        }
    }

    // Event listener for the button
    document.getElementById("togglePassVisibility").addEventListener("click", function() {
        togglePasswordVisibility();
    });

    // Function to validate form
    function validateForm() {
        var firstname = document.getElementById('firstname').value;
        var lastname = document.getElementById('lastname').value;
        var username = document.getElementById('username').value;
        var email = document.getElementById('email').value;
        var dob = document.getElementById('dob').value;
        var doj = document.getElementById('doj').value;
        var designation = document.getElementById('designation').value;
        var department = document.getElementById('department').value;
        var pnum = document.getElementById('pnum').value;
        var pass = document.getElementById('pass').value;
        var pass2 = document.getElementById('pass2').value;
        var profile = document.getElementById('profile').value;

        // Perform validation
        if (firstname === '' || lastname === '' || username === '' || email === '' || dob === '' || doj === '' || designation === '' || department === '' || pnum === '' || pass === '' || pass2 === '' || profile === '') {
            alert('Please fill in all fields');
            return false;
        }

        // Password validation
        if (pass !== pass2) {
            alert('Passwords do not match');
            return false;
        }

        // Check password strength (at least 8 characters including uppercase, lowercase, and digits)
        var strongRegex = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})");
        if (!strongRegex.test(pass)) {
            alert('Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, and one digit');
            return false;
        }

        // Check age (above 18)
        var dobDate = new Date(dob);
        var todayDate = new Date();
        var age = todayDate.getFullYear() - dobDate.getFullYear();
        var monthDiff = todayDate.getMonth() - dobDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && todayDate.getDate() < dobDate.getDate())) {
            age--;
        }
        if (age < 18) {
            alert('You must be at least 18 years old to register');
            return false;
        }

        // Check if date of joining is before today
        var dojDate = new Date(doj);
        if (dojDate > todayDate) {
            alert('Date of joining must be before today');
            return false;
        }

        // Check phone number length
        if (pnum.length < 10) {
            alert('Phone number must be at least 10 digits long');
            return false;
        }
        
        // If all validations pass, return true to submit the form
        return true;
    }
    function displayAlertMsg() {
        var alertDiv = document.getElementById('alertMsg');
        alertDiv.classList.remove('hidden');
        setTimeout(function() {
            alertDiv.classList.add('hidden');
        }, 3000); // Hide the message after 3 seconds (3000 milliseconds)
    }
    
    // Check for success message in the URL query parameters
    var urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('success')) {
        // Display the alert message if success parameter is present
        displayAlertMsg();
    }
    
</script>
</html>